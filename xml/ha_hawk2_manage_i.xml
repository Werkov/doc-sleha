<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1
[
  <!ENTITY % entities SYSTEM "entity-decl.ent">
    %entities;
]>
<!-- Converted by suse-upgrade version 1.1 -->
<sect1 xmlns="http://docbook.org/ns/docbook" 
 xmlns:xi="http://www.w3.org/2001/XInclude" 
 xmlns:xlink="http://www.w3.org/1999/xlink" 
 version="5.0" xml:id="sec.conf.hawk2.manage">
  
  <title>Managing Cluster Resources</title>
  
    <info>
   <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
    <dm:maintainer/>
    <dm:status>editing</dm:status>
    <dm:deadline/>
    <dm:priority/>
    <dm:translation>yes</dm:translation>
    <dm:languages/>
    <dm:release/>
    <dm:repository/>
   </dm:docmanager>
    </info>
 
  <para> In addition to configuring your cluster resources, &hawk2; allows you to manage existing
   resources from the <guimenu>Status</guimenu> screen. For a general overview of the screen refer
   to <xref linkend="sec.conf.hawk2.manage.monitor.status"/>.</para>

  <sect2 xml:id="sec.conf.hawk2.manage.edit">
   <title>Editing Resources and Groups</title>
   <para>
    In case you need to edit existing resources, go to the <guimenu>Status</guimenu>
    screen. In the <guimenu>Operations</guimenu> column, click the arrow down
    icon next to the resource or group you want to modify and select <guimenu>Edit</guimenu>.
   </para>
   <para>
    The editing screen appears. If you edit a primitive resource, the following
    operations are available:
   </para>

   <itemizedlist>
    <title>Operations for Primitives</title>
    <listitem>
     <para>Copying the resource.</para>
    </listitem>
    <listitem>
     <para>Renaming the resource (changing its ID).</para>
    </listitem>
    <listitem>
     <para>Deleting the resource.</para>
    </listitem>
   </itemizedlist>

   <para>
     If you edit a group, the following operations are available:
   </para>
   <itemizedlist>
    <title>Operations for Groups</title>
    <listitem>
     <para>Creating a new primitive which will be added to this group.</para>
    </listitem>
    <listitem>
     <para>Renaming the group (changing its ID).</para>
    </listitem>
    <listitem>
     <para>Re-sort group members by dragging and dropping them into the
      order you want using the <quote>handle</quote> icon on the right.</para>
    </listitem>
    </itemizedlist>
  </sect2>

  <sect2 xml:id="sec.conf.hawk2.manage.start">
   <title>Starting Resources</title>
   <para> Before you start a cluster resource, make sure it is set up correctly. For example, if you
    use an Apache server as a cluster resource, set up the Apache server first. Complete the
    Apache configuration before starting the respective resource in your cluster. </para>
   <note>
    <title>Do Not Touch Services Managed by the Cluster</title>
    <para> When managing a resource via the &hasi;, the resource must not be started or
     stopped otherwise (outside of the cluster, for example manually or on boot or reboot). The
     &hasi; software is responsible for all service start or stop actions. </para>
    <para> However, if you want to check if the service is configured properly, start it manually,
     but make sure that it is stopped again before the &hasi; takes over. </para>
    <para> For interventions in resources that are currently managed by the cluster, set the
     resource to <literal>maintenance mode</literal> first. <remark>taroth 2015-12-04: ToDo: add
      for next revision: krig - how does that work with hawk2? does it work already? 
      I searched in the Operations column for a resource but could not find anything there...
      krig 2015-12-08: Ah! That's the "Unmanage" operation on resources.</remark>
    </para>
   </note>
   <para> When creating a resource with &hawk2;, you can set its initial state with the
     <literal>target-role</literal> meta attribute. If you set its value to
     <literal>stopped</literal>, the resource does not start automatically after being created. </para>
   <procedure xml:id="pro.hawk2.rsc.start">
    <title>Starting A New Resource</title>
    <step>
     <para>Log in to &hawk2;:</para>
     <screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
    </step>
    <step>
     <para> In the left navigation bar, select <guimenu>Status</guimenu>. The list of
       <guimenu>Resources</guimenu> also shows the <guimenu>Status</guimenu>. </para>
    </step>
    <step>
     <para> Select the resource to start. In its <guimenu>Operations</guimenu> column click the
       <guimenu>Start</guimenu> icon. To continue, confirm the message that appears. </para>
     <para>When the resource has started, &hawk2; changes the resource's
       <guimenu>Status</guimenu> to green and shows on which node it is running. </para>
    </step>
   </procedure>
  </sect2>
  <sect2 xml:id="sec.conf.hawk2.manage.cleanup">
   <title>Cleaning Up Resources</title>
   <para> A resource will be automatically restarted if it fails, but each failure increases the
    resource's failcount. </para>
   <para> If a <literal>migration-threshold</literal> has been set for the resource, the node will
    no longer run the resource when the number of failures reaches the migration threshold. </para>
   <para> A resource's failcount can either be reset automatically (by setting a
     <literal>failure-timeout</literal> option for the resource) or it can be reset manually as
    described below. </para>
   <procedure xml:id="pro.hawk2.clean">
    <title>Cleaning Up A Resource</title>
    <step>
     <para>Log in to &hawk2;:</para>
     <screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
    </step>
    <step>
     <para> In the left navigation bar, select <guimenu>Status</guimenu>. The list of
       <guimenu>Resources</guimenu> also shows the <guimenu>Status</guimenu>. </para>
    </step>
    <step>
     <para> Go to the resource to clean up. In the <guimenu>Operations</guimenu> column click the
      arrow down button and select <guimenu>Cleanup</guimenu>. To continue, confirm the message that
      appears. </para>
     <para>This executes the
      command <command>crm resource cleanup</command> and cleans up the
      resource on all nodes. </para>
    </step>
   </procedure>
  </sect2>
  <sect2 xml:id="sec.conf.hawk2.manage.remove">
   <title>Removing Cluster Resources</title>
   <para> If you need to remove a resource from the cluster, follow the procedure below to avoid
    configuration errors: </para>
   <procedure xml:id="pro.hawk2.rsc.rm">
    <title>Removing a Cluster Resource</title>
    <step>
     <para>Log in to &hawk2;:</para>
     <screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
    </step>
    <step>
     <para> Clean up the resource on all nodes as described in <xref linkend="pro.hawk2.clean"/>.
     </para>
    </step>
    <step>
     <para>Stop the resource:</para>
     <substeps>
      <step>
       <para> In the left navigation bar, select <guimenu>Status</guimenu>. The list of
         <guimenu>Resources</guimenu> also shows the <guimenu>Status</guimenu>. </para>
      </step>
      <step>
       <para>In the <guimenu>Operations</guimenu> column click the <guimenu>Stop</guimenu> button
        next to the resource. </para>
      </step>
      <step>
       <para>To continue, confirm the message that appears.</para>
       <para>The <guimenu>Status</guimenu> column will reflect the change when the resource is
        stopped.</para>
      </step>
     </substeps>
    </step>
    <step>
     <para>Delete the resource:</para>
     <substeps>
      <step>
       <para> In the left navigation bar, select <guimenu>Edit</guimenu>. </para>
      </step>
      <step>
       <para>In the list of <guimenu>Resources</guimenu>, go to the respective resource. From the
         <guimenu>Operations</guimenu> column click the <guimenu>Delete</guimenu> icon next to the
        resource.<remark>taroth 2016-10-25: todo - on first sight, did not find the "Delete" icon any more,
         investigate!</remark></para>
      </step>
      <step>
       <para>To continue, confirm the message that appears.</para>
      </step>
     </substeps>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec.conf.hawk2.manage.migrate">
   <title>Migrating Cluster Resources</title>
   <para> As mentioned in <xref linkend="sec.conf.hawk2.failover"/>, the cluster will fail over
    (migrate) resources automatically in case of software or hardware failures&mdash;according
    to certain parameters you can define (for example, migration threshold or resource stickiness).
    You can also manually migrate a resource to another node in the cluster. Or you
    decide to move the resource away from the current node and let the cluster decide where to put it. </para>
   <procedure xml:id="pro.hawk2.rsc.migrate">
    <title>Manually Migrating a Resource</title>
    <step>
     <para>Log in to &hawk2;:</para>
     <screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
    </step>
    <step>
     <para> In the left navigation bar, select <guimenu>Status</guimenu>. The list of
       <guimenu>Resources</guimenu> also shows the <guimenu>Status</guimenu>. </para>
    </step>
    <step>
     <para>In the list of <guimenu>Resources</guimenu>, select the respective resource.</para>
    </step>
    <step>
     <para><remark>taroth 2015-12-07: krig, is there any way to select which node to migrate the
       resource to? krig: also, Hawk1 has two options: "Move" (lets you select where to move the rsc
       to and creates a location constraint with an INFINITY score for the destination node) and
       "Away from current node" (creates a location constraint with a -INFINITY score for the
       current node) - is there anything like this with Hawk2? - taroth 2015-12-08: on behalf of
       krig, filed https://bugzilla.suse.com/show_bug.cgi?id=958386 for this </remark>In the
       <guimenu>Operations</guimenu> column click the arrow down button and select
       <guimenu>Migrate</guimenu>. To continue, confirm the message that appears.</para>
    </step>
   </procedure>
   <para> To allow a resource to move back again, proceed as follows: </para>
   <procedure xml:id="pro.hawk2.rsc.migrate.back">
    <title>Unmigrating a Resource</title>

    <step>
     <para>Log in to &hawk2;:</para>
     <screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
    </step>
    <step>
     <para> In the left navigation bar, select <guimenu>Status</guimenu>. The list of
       <guimenu>Resources</guimenu> also shows the <guimenu>Status</guimenu>. </para>
    </step>
    <step>
     <para>In the list of <guimenu>Resources</guimenu>, go to the respective resource.</para>
    </step>
    <step>
     <para>In the <guimenu>Operations</guimenu> column click the arrow down button and select
       <guimenu>Unmigrate</guimenu>. To continue, confirm the message that appears.</para>
     <para>
        &hawk2; uses the <command>crm_resource&nbsp;</command>
        <option>-U</option> command. The resource
       can move back to its original location or it may stay where it is
      (depending on resource stickiness).</para>
    </step>
   </procedure>

   <para> For more information, see &paceex;, available from <link
     xlink:href="http://www.clusterlabs.org/doc/"/>. Refer to section
    <citetitle>Resource Migration</citetitle>. </para>
  </sect2>
 
  <sect2 xml:id="sec.conf.hawk2.manage.monitor.batch">
  <title>Using the Batch Mode</title>
  <para> &hawk2; provides a <guimenu>Batch Mode</guimenu>, including a
   <emphasis>cluster simulator</emphasis>. It can be used for the following:</para>
  <itemizedlist>
   <listitem>
    <para> Staging changes to the cluster and applying them as a single transaction, instead of
     having each change take effect immediately. </para>
   </listitem>
   <listitem>
    <para>Simulating changes and cluster events, for example, to explore potential failure
     scenarios.</para>
   </listitem>
  </itemizedlist>

  <para> For example, batch mode can be used when creating groups of resources that depend on each
   other. Using batch mode, you can avoid to apply intermediate or incomplete configurations to the
   cluster. </para>
  <para> While batch mode is enabled, you can add or edit resources and constraints or change the
   cluster configuration. It is also possible to simulate events in the cluster, including nodes
   going online or offline, resource operations and tickets being granted or revoked. See
   <xref linkend="pro.hawk2.batch.inject"/> for details.</para>
  <para> The <emphasis>cluster simulator</emphasis> runs automatically after every change and shows
   the expected outcome in the user interface. For example, this also means, if you stop a resource
   while in batch mode, the user interface shows the resource as stopped&mdash;while actually,
   the resource is still running.</para>
  <important>
   <title>Wizards and Changes to the Live System</title>
   <para>Some wizards include actions beyond mere cluster configuration. When using those wizards in
    batch mode, any changes that go beyond cluster configuration would be applied to the live system
    immediately.</para>
   <para>Therefore wizards that require &rootuser; permission cannot be executed in batch mode.
   </para>
  </important>

  <procedure xml:id="pro.conf.hawk2.manage.monitor.batch">
   <title>Working with the Batch Mode</title>
   <step>
    <para>Log in to &hawk2;:</para>
    <screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
   </step>
   <step>
    <para> To activate the batch mode, select <guimenu>Batch</guimenu> from the top-level row. </para>
    <para>An additional bar appears below the top-level row. It indicates that batch mode is active
     and contains links to actions that you can execute in batch mode.
    <remark>taroth 2016-10-26: add screenshot?</remark></para>
   </step>
   <step>
    <para> While batch mode is active, perform any changes to your cluster, like
     adding or editing resources and constraints or editing the cluster configuration.</para>
    <para>The changes will be simulated and shown in all screens.</para>
   </step>
   <step>
    <para>To view details of the changes you have made, select <guimenu>Show</guimenu>
    from the batch mode bar. The <guimenu>Batch Mode</guimenu> window opens.</para>
    <para>For any configuration changes it shows the difference between the live
     state and the simulated changes in &crmsh; syntax:
     Lines starting with a <literal>-</literal> character represent the current
     state whereas lines starting with <literal>+</literal> show the proposed
     state.
    </para>
   </step>
   <step>
    <para>To inject events or view even more details, see
     <xref linkend="pro.hawk2.batch.inject" xrefstyle="select:label"/>.
     Otherwise <guimenu>Close</guimenu> the window.</para>
   </step>
   <step>
    <para>Choose to either <guimenu>Discard</guimenu> or <guimenu>Apply</guimenu>
     the simulated changes and confirm your choice. This also deactivates batch mode
     and takes you back to normal mode.</para>
   </step>
  </procedure>

  <para>When running in batch mode, &hawk2; also allows you to inject
   <guimenu>Node Events</guimenu> and <guimenu>Resource Events</guimenu>.
  </para>
  <variablelist>
   <varlistentry>
    <term><guimenu>Node Events</guimenu></term>
    <listitem>
     <para>Let you change the state of a node. Available states are
      <guimenu>online</guimenu>, <guimenu>offline</guimenu>, and
      <guimenu>unclean</guimenu>. </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><guimenu>Resource Events</guimenu></term>
    <listitem>
     <para>Let you change some properties of a resource. For example, you can set
      an operation (like <literal>start</literal>,
      <literal>stop</literal>, <literal>monitor</literal>), the
      node it applies to, and the expected result to be
      simulated.</para>
    </listitem>
   </varlistentry>
  </variablelist>

  <procedure xml:id="pro.hawk2.batch.inject">
   <title>Injecting Node and Resource Events</title>
   <step>
    <para>Log in to &hawk2;:</para>
    <screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
   </step>
   <step>
    <para>If batch mode is not active yet, click <guimenu>Batch</guimenu> at the
     top-level row to switch to batch mode.</para>
   </step>
   <step>
    <para>In the batch mode bar, click <guimenu>Show</guimenu> to
     open the <guimenu>Batch Mode</guimenu> window.</para>
   </step>
   <step>
    <para>To simulate a status change of a node:</para>
    <substeps>
     <step>
      <para>Click <menuchoice>
        <guimenu>Inject</guimenu>
        <guimenu>Node Event</guimenu>
       </menuchoice>.</para>
     </step>
     <step>
      <para>Select the <guimenu>Node</guimenu> you want to manipulate and select
       its target <guimenu>State</guimenu>.</para>
     </step>
     <step>
      <para>Confirm your changes. Your event is added to the queue of events listed in
       the <guimenu>Batch Mode</guimenu> dialog.</para>
     </step>
    </substeps>
   </step>
   <step>
    <para>To simulate a resource operation:</para>
    <substeps>
     <step>
      <para>Click <menuchoice>
       <guimenu>Inject</guimenu>
       <guimenu>Resource Event</guimenu>
      </menuchoice>.</para>
     </step>
     <step>
      <para>Select the <guimenu>Resource</guimenu> you want to manipulate and select
       the <guimenu>Operation</guimenu> to simulate.</para>
     </step>
     <step>
      <para>If necessary, define an <guimenu>Interval</guimenu>.</para></step>
     <step>
      <para>Select the <guimenu>Node</guimenu> on which to run the operation and
       the targeted <guimenu>Result</guimenu>. Your event is added to the queue
       of events listed in the <guimenu>Batch Mode</guimenu> dialog.</para>
     </step>
     <step>
      <para>Confirm your changes.</para>
     </step>
    </substeps>
    <para>The <guimenu>Batch Mode</guimenu> dialog
     (<xref linkend="fig.hawk2.batch.show" xrefstyle="select:label"/>)
     shows a new line per injected event. Any event listed here is simulated
     immediately and is reflected on the <guimenu>Status</guimenu> screen.
    </para>
    <para>If you have made any configuration changes, too, the difference between
     the live state and the simulated changes is shown below the injected events.
    </para>
    <figure xml:id="fig.hawk2.batch.show">
     <title>&hawk2; Batch Mode&mdash;Injected Invents and Configuration Changes</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="hawk2-batchmode-show.png" width="100%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="hawk2-batchmode-show.png" width="100%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
   </step>
   <step>
    <para>To remove an injected event, click the <guimenu>Remove</guimenu> icon
     next to it. &hawk2; updates the <guimenu>Status</guimenu> screen accordingly.
    </para>
   </step>
   <step>
    <para>
     To view more details about the simulation run, click <guimenu>Simulator</guimenu>
     and choose one of the following:
    </para>
    <variablelist>
     <varlistentry>
      <term><guimenu>Summary</guimenu></term>
      <listitem>
       <para>Shows a detailed summary.</para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><guimenu>CIB (in)</guimenu>/<guimenu>CIB (out)</guimenu></term>
      <listitem>
       <para><guimenu>CIB (in)</guimenu> shows the initial CIB state.
        <guimenu>CIB (out)</guimenu> shows what the CIB would look like after
        the transition.</para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><guimenu>Transition Graph</guimenu></term>
      <listitem>
       <para>Shows a graphical representation of the transition.</para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><guimenu>Transition</guimenu></term>
      <listitem>
       <para>Shows an XML representation of the transition.</para>
      </listitem>
     </varlistentry>
    </variablelist>
   </step>
   <step>
    <para>If you have reviewed the simulated changes, close the <guimenu>Batch
     Mode</guimenu> window.
   </para>
   </step>
   <step>
    <para>To leave the batch mode, either <guimenu>Apply</guimenu> or
     <guimenu>Discard</guimenu> the simulated changes.</para>
   </step>
  </procedure>
 </sect2>
</sect1>
